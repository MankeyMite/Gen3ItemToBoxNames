<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Get Any Item (Emerald ACE)</title>
  <style>
    :root{ --ink:#111; --muted:#555; --border:#ddd; --bg:#fff; --mono: ui-monospace,SFMono-Regular,Menlo,Consolas,"Liberation Mono",monospace; }
    html,body{height:100%}
    body{margin:0; background:var(--bg); color:var(--ink); font:16px/1.5 system-ui,Segoe UI,Roboto,Arial,Helvetica,sans-serif;}
    .wrap{max-width:820px;margin:24px auto;padding:0 16px}
    h1{font-size:24px;margin:0 0 8px}
    .muted{color:var(--muted);font-size:13px}
    label{font-weight:600}
    .row{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
    input[type="text"]{
      border:1px solid var(--border); border-radius:6px; padding:8px 10px; min-width:260px;
      font:14px/1.4 var(--mono); background:#fafafa;
    }
    .mode{gap:14px}
    button{border:1px solid var(--border);background:#f3f3f3;border-radius:6px;padding:8px 12px;cursor:pointer}
    button.primary{background:#eaeaea;font-weight:600}
    pre.output{white-space:pre-wrap;overflow:auto;border:1px solid var(--border);border-radius:6px;padding:10px 12px;background:#fafafa;font:14px/1.45 var(--mono);margin-top:10px}

    /* Compact custom dropdown */
    .combo{position:relative;display:inline-block}
    .listbox{
      position:absolute;left:0;right:0;z-index:1000;background:#fff;border:1px solid var(--border);
      border-radius:6px;margin-top:4px;max-height:60vh;overflow-y:auto;box-shadow:0 8px 24px rgba(0,0,0,.08);
      display:none; overscroll-behavior: contain;
    }
    .option{padding:8px 10px;font:14px/1.4 var(--mono);cursor:pointer}
    .option:hover,.option[aria-selected="true"]{background:#f3f3f3}

    /* Collapsible source */
    details{margin-top:16px}
    details > summary{cursor:pointer; user-select:none}
  </style>
</head>
<body>
  <div class="wrap">
    <h1>Get Any Item (Pokémon Emerald ACE)</h1>
    <p class="muted">
      Gen 3 tool for ACE codes in Emerald. After you execute the code, you can get the item from the Lilycove Store from the lottery lady on the first floor.
    </p>

    <div class="row mode" style="margin:10px 0 6px">
      <label>Mode:</label>
      <label><input type="radio" name="emu" value="modern" checked> Console / mGBA</label>
      <label><input type="radio" name="emu" value="old"> Old emulator</label>
    </div>

    <label for="item">Item</label>
    <div class="row" style="margin-top:6px">
      <div class="combo" id="combo" style="min-width:260px">
        <input id="item" placeholder="Type or pick an item…" autocomplete="off"
               aria-autocomplete="list" aria-expanded="false" aria-controls="item-list" />
        <div id="item-list" role="listbox" class="listbox"></div>
      </div>
      <span class="muted">Hex: <span id="hexPreview">—</span></span>
      <button id="genBtn" class="primary">Generate code</button>
    </div>

    <div id="err" class="muted" style="color:#b00020;font-weight:600;margin-top:6px"></div>

    <h2 style="font-size:18px;margin:18px 0 8px">Code</h2>
    <pre id="out" class="output" aria-label="ACE code output"></pre>

    <!-- Collapsible source code -->
    <details id="srcWrap">
      <summary class="muted">Show source code</summary>
      <pre id="src" class="output" aria-label="ACE source" style="margin-top:8px"></pre>
    </details>
  </div>

  <script>
    // --- Data -----------------------------------------------------------------
    const ITEMS = [
["Master Ball", "0001"],
  ["Ultra Ball", "0002"],
  ["Great Ball", "0003"],
  ["Poké Ball", "0004"],
  ["Safari Ball", "0005"],
  ["Net Ball", "0006"],
  ["Dive Ball", "0007"],
  ["Nest Ball", "0008"],
  ["Repeat Ball", "0009"],
  ["Timer Ball", "000A"],
  ["Luxury Ball", "000B"],
  ["Premier Ball", "000C"],
  ["Potion", "000D"],
  ["Antidote", "000E"],
  ["Burn Heal", "000F"],
  ["Ice Heal", "0010"],
  ["Awakening", "0011"],
  ["Paralyze Heal", "0012"],
  ["Full Restore", "0013"],
  ["Max Potion", "0014"],
  ["Hyper Potion", "0015"],
  ["Super Potion", "0016"],
  ["Full Heal", "0017"],
  ["Revive", "0018"],
  ["Max Revive", "0019"],
  ["Fresh Water", "001A"],
  ["Soda Pop", "001B"],
  ["Lemonade", "001C"],
  ["Moomoo Milk", "001D"],
  ["Energy Powder", "001E"],
  ["Energy Root", "001F"],
  ["Heal Powder", "0020"],
  ["Revival Herb", "0021"],
  ["Ether", "0022"],
  ["Max Ether", "0023"],
  ["Elixir", "0024"],
  ["Max Elixir", "0025"],
  ["Lava Cookie", "0026"],
  ["Blue Flute", "0027"],
  ["Yellow Flute", "0028"],
  ["Red Flute", "0029"],
  ["Black Flute", "002A"],
  ["White Flute", "002B"],
  ["Berry Juice", "002C"],
  ["Sacred Ash", "002D"],
  ["Shoal Salt", "002E"],
  ["Shoal Shell", "002F"],
  ["Red Shard", "0030"],
  ["Blue Shard", "0031"],
  ["Yellow Shard", "0032"],
  ["Green Shard", "0033"],
  ["HP Up", "003F"],
  ["Protein", "0040"],
  ["Iron", "0041"],
  ["Carbos", "0042"],
  ["Calcium", "0043"],
  ["Rare Candy", "0044"],
  ["PP Up", "0045"],
  ["Zinc", "0046"],
  ["PP Max", "0047"],
  ["Guard Spec.", "0049"],
  ["Dire Hit", "004A"],
  ["X Attack", "004B"],
  ["X Defense", "004C"],
  ["X Speed", "004D"],
  ["X Accuracy", "004E"],
  ["X Sp. Atk", "004F"],
  ["Poké Doll", "0050"],
  ["Fluffy Tail", "0051"],
  ["Super Repel", "0053"],
  ["Max Repel", "0054"],
  ["Escape Rope", "0055"],
  ["Repel", "0056"],
  ["Sun Stone", "005D"],
  ["Moon Stone", "005E"],
  ["Fire Stone", "005F"],
  ["Thunder Stone", "0060"],
  ["Water Stone", "0061"],
  ["Leaf Stone", "0062"],
  ["Tiny Mushroom", "0067"],
  ["Big Mushroom", "0068"],
  ["Pearl", "006A"],
  ["Big Pearl", "006B"],
  ["Stardust", "006C"],
  ["Star Piece", "006D"],
  ["Nugget", "006E"],
  ["Heart Scale", "006F"],
  ["Orange Mail", "0079"],
  ["Harbor Mail", "007A"],
  ["Glitter Mail", "007B"],
  ["Mech Mail", "007C"],
  ["Wood Mail", "007D"],
  ["Wave Mail", "007E"],
  ["Bead Mail", "007F"],
  ["Shadow Mail", "0080"],
  ["Tropic Mail", "0081"],
  ["Dream Mail", "0082"],
  ["Fab Mail", "0083"],
  ["Retro Mail", "0084"],
  ["Cheri Berry", "0085"],
  ["Chesto Berry", "0086"],
  ["Pecha Berry", "0087"],
  ["Rawst Berry", "0088"],
  ["Aspear Berry", "0089"],
  ["Leppa Berry", "008A"],
  ["Oran Berry", "008B"],
  ["Persim Berry", "008C"],
  ["Lum Berry", "008D"],
  ["Sitrus Berry", "008E"],
  ["Figy Berry", "008F"],
  ["Wiki Berry", "0090"],
  ["Mago Berry", "0091"],
  ["Aguav Berry", "0092"],
  ["Iapapa Berry", "0093"],
  ["Razz Berry", "0094"],
  ["Bluk Berry", "0095"],
  ["Nanab Berry", "0096"],
  ["Wepear Berry", "0097"],
  ["Pinap Berry", "0098"],
  ["Pomeg Berry", "0099"],
  ["Kelpsy Berry", "009A"],
  ["Qualot Berry", "009B"],
  ["Hondew Berry", "009C"],
  ["Grepa Berry", "009D"],
  ["Tamato Berry", "009E"],
  ["Cornn Berry", "009F"],
  ["Magost Berry", "00A0"],
  ["Rabuta Berry", "00A1"],
  ["Nomel Berry", "00A2"],
  ["Spelon Berry", "00A3"],
  ["Pamtre Berry", "00A4"],
  ["Watmel Berry", "00A5"],
  ["Durin Berry", "00A6"],
  ["Belue Berry", "00A7"],
  ["Liechi Berry", "00A8"],
  ["Ganlon Berry", "00A9"],
  ["Salac Berry", "00AA"],
  ["Petaya Berry", "00AB"],
  ["Apicot Berry", "00AC"],
  ["Lansat Berry", "00AD"],
  ["Starf Berry", "00AE"],
  ["Enigma Berry", "00AF"],
  ["Bright Powder", "00B3"],
  ["White Herb", "00B4"],
  ["Macho Brace", "00B5"],
  ["Exp. Share", "00B6"],
  ["Quick Claw", "00B7"],
  ["Soothe Bell", "00B8"],
  ["Mental Herb", "00B9"],
  ["Choice Band", "00BA"],
  ["King's Rock", "00BB"],
  ["SilverPowder", "00BC"],
  ["Amulet Coin", "00BD"],
  ["Cleanse Tag", "00BE"],
  ["Soul Dew", "00BF"],
  ["Deep Sea Tooth", "00C0"],
  ["Deep Sea Scale", "00C1"],
  ["Smoke Ball", "00C2"],
  ["Everstone", "00C3"],
  ["Focus Band", "00C4"],
  ["Lucky Egg", "00C5"],
  ["Scope Lens", "00C6"],
  ["Metal Coat", "00C7"],
  ["Leftovers", "00C8"],
  ["Dragon Scale", "00C9"],
  ["Light Ball", "00CA"],
  ["Soft Sand", "00CB"],
  ["Hard Stone", "00CC"],
  ["Miracle Seed", "00CD"],
  ["Black Glasses", "00CE"],
  ["Black Belt", "00CF"],
  ["Magnet", "00D0"],
  ["Mystic Water", "00D1"],
  ["Sharp Beak", "00D2"],
  ["Poison Barb", "00D3"],
  ["Never-Melt Ice", "00D4"],
  ["Spell Tag", "00D5"],
  ["Twisted Spoon", "00D6"],
  ["Charcoal", "00D7"],
  ["Dragon Fang", "00D8"],
  ["Silk Scarf", "00D9"],
  ["Up-Grade", "00DA"],
  ["Shell Bell", "00DB"],
  ["Sea Incense", "00DC"],
  ["Lax Incense", "00DD"],
  ["Lucky Punch", "00DE"],
  ["Metal Powder", "00DF"],
  ["Thick Club", "00E0"],
  ["Stick", "00E1"],
  ["Red Scarf", "00FE"],
  ["Blue Scarf", "00FF"],
  ["Pink Scarf", "0100"],
  ["Green Scarf", "0101"],
  ["Yellow Scarf", "0102"],
  ["Mach Bike", "0103"],
  ["Coin Case", "0104"],
  ["Itemfinder", "0105"],
  ["Old Rod", "0106"],
  ["Good Rod", "0107"],
  ["Super Rod", "0108"],
  ["S.S. Ticket", "0109"],
  ["Contest Pass", "010A"],
  ["Wailmer Pail", "010C"],
  ["Devon Parts", "010D"],
  ["Soot Sack", "010E"],
  ["Basement Key", "010F"],
  ["Acro Bike", "0110"],
  ["Pokéblock Case", "0111"],
  ["Letter", "0112"],
  ["Eon Ticket", "0113"],
  ["Red Orb", "0114"],
  ["Blue Orb", "0115"],
  ["Scanner", "0116"],
  ["Go-Goggles", "0117"],
  ["Meteorite", "0118"],
  ["Key to Room 1", "0119"],
  ["Key to Room 2", "011A"],
  ["Key to Room 4", "011B"],
  ["Key to Room 6", "011C"],
  ["Storage Key", "011D"],
  ["Root Fossil", "011E"],
  ["Claw Fossil", "011F"],
  ["Devon Scope", "0120"],
  ["TM01", "0121"],
  ["TM02", "0122"],
  ["TM03", "0123"],
  ["TM04", "0124"],
  ["TM05", "0125"],
  ["TM06", "0126"],
  ["TM07", "0127"],
  ["TM08", "0128"],
  ["TM09", "0129"],
  ["TM10", "012A"],
  ["TM11", "012B"],
  ["TM12", "012C"],
  ["TM13", "012D"],
  ["TM14", "012E"],
  ["TM15", "012F"],
  ["TM16", "0130"],
  ["TM17", "0131"],
  ["TM18", "0132"],
  ["TM19", "0133"],
  ["TM20", "0134"],
  ["TM21", "0135"],
  ["TM22", "0136"],
  ["TM23", "0137"],
  ["TM24", "0138"],
  ["TM25", "0139"],
  ["TM26", "013A"],
  ["TM27", "013B"],
  ["TM28", "013C"],
  ["TM29", "013D"],
  ["TM30", "013E"],
  ["TM31", "013F"],
  ["TM32", "0140"],
  ["TM33", "0141"],
  ["TM34", "0142"],
  ["TM35", "0143"],
  ["TM36", "0144"],
  ["TM37", "0145"],
  ["TM38", "0146"],
  ["TM39", "0147"],
  ["TM40", "0148"],
  ["TM41", "0149"],
  ["TM42", "014A"],
  ["TM43", "014B"],
  ["TM44", "014C"],
  ["TM45", "014D"],
  ["TM46", "014E"],
  ["TM47", "014F"],
  ["TM48", "0150"],
  ["TM49", "0151"],
  ["TM50", "0152"],
  ["HM01", "0153"],
  ["HM02", "0154"],
  ["HM03", "0155"],
  ["HM04", "0156"],
  ["HM05", "0157"],
  ["HM06", "0158"],
  ["HM07", "0159"],
  ["HM08", "015A"],
  ["Parcel", "015D"],
  ["Poké Flute", "015E"],
  ["Secret Key", "015F"],
  ["Bike Voucher", "0160"],
  ["Gold Teeth", "0161"],
  ["Old Amber", "0162"],
  ["Card Key", "0163"],
  ["Lift Key", "0164"],
  ["Helix Fossil", "0165"],
  ["Dome Fossil", "0166"],
  ["Silph Scope", "0167"],
  ["Bicycle", "0168"],
  ["Town Map", "0169"],
  ["Vs. Seeker", "016A"],
  ["Fame Checker", "016B"],
  ["TM Case", "016C"],
  ["Berry Pouch", "016D"],
  ["Teachy TV", "016E"],
  ["Tri-Pass", "016F"],
  ["Rainbow Pass", "0170"],
  ["Tea", "0171"],
  ["MysticTicket", "0172"],
  ["AuroraTicket", "0173"],
  ["Powder Jar", "0174"],
  ["Ruby", "0175"],
  ["Sapphire", "0176"],
  ["Magma Emblem", "0177"],
  ["Old Sea Map", "0178"],
    ];

    // Templates
    const TEMPLATES = {
      modern: ["–BUnL…!n","AA$FF.o","AA@TBn","A#RBn","%PBnAFQm","RToDYJm?","Bn"],
      old:    ["–BUnN…!n","AA$FF.o","AA@TBn","A#RBn","%PBnAFQm","RToDYJm?","Bn"]
    };

    // Maps
    const mapBox2 = ['F','G','H','I','J','K','L','M','N','O','P','Q','R','S','T','U']; // by h0
    const mapBox3 = ['J','K','L','M','N','O','P','Q','R','S','T','U','V','W','X','Y']; // by h1
    const mapBox4 = ['I','J','K','L','M','N','O','P','Q','R','S','T','U','V','W','X']; // by h2
    const mapBox5 = ['I','J','K','L','M','N','O','P','Q','R','S','T','U','V','W','X']; // by h3

    // --- Helpers --------------------------------------------------------------
    const stripAccents = (s) => s.normalize('NFD').replace(/[\u0300-\u036f]/g,'');
    const normalizeName = (s) => stripAccents(s).toLowerCase();

    function resolveHex(input){
      const s = (input || '').trim();
      if (!s) return null;

      // direct hex
      const m = s.match(/^(?:0x)?([0-9a-fA-F]{4})$/);
      if (m) return m[1].toUpperCase();

      const needle = normalizeName(s);
      let hit = ITEMS.find(([n]) => normalizeName(n) === needle);
      if (hit) return hit[1].toUpperCase();
      hit = ITEMS.find(([n]) => normalizeName(n).startsWith(needle));
      if (hit) return hit[1].toUpperCase();

      return null;
    }

    function computeBoxes(hex, mode){
      const h3 = parseInt(hex[0], 16);
      const h2 = parseInt(hex[1], 16);
      const h1 = parseInt(hex[2], 16);
      const h0 = parseInt(hex[3], 16);

      const t = [...TEMPLATES[mode]];
      t[1] = t[1].replace('$', mapBox2[h0]);
      t[2] = t[2].replace('@', mapBox3[h1]);
      t[3] = t[3].replace('#', mapBox4[h2]);
      t[4] = t[4].replace('%', mapBox5[h3]);
      return t;
    }

    function formatOutput(boxes){
      const labels = ["Box 1","Box 2","Box 3","Box 4","Box 5","Box 6","Box 7"];
      let s = '';
      boxes.forEach((b,i)=>{ s += `${labels[i]}: ${b} [${b}]\n`; });
      return s.trimEnd();
    }

    // --- UI: robust custom dropdown ------------------------------------------
    const combo       = document.getElementById('combo');
    const itemInput   = document.getElementById('item');
    const listbox     = document.getElementById('item-list');
    const hexPreview  = document.getElementById('hexPreview');
    const out         = document.getElementById('out');
    const err         = document.getElementById('err');
    const genBtn      = document.getElementById('genBtn');
    const srcPre      = document.getElementById('src');

    let options = [];     // filtered [name, hex]
    let activeIndex = -1;

    function openList(){
      listbox.style.display = 'block';
      itemInput.setAttribute('aria-expanded','true');
    }
    function closeList(){
      listbox.style.display = 'none';
      itemInput.setAttribute('aria-expanded','false');
    }

    // Keep scrolling inside the list
    listbox.addEventListener('wheel', (e)=> {
      const atTop = listbox.scrollTop === 0 && e.deltaY < 0;
      const atBottom = Math.ceil(listbox.scrollTop + listbox.clientHeight) >= listbox.scrollHeight && e.deltaY > 0;
      if (!atTop && !atBottom) e.stopPropagation();
    }, { passive: false });

    function renderList(){
      const frag = document.createDocumentFragment();
      listbox.innerHTML = '';
      options.forEach(([name, hex], idx)=>{
        const div = document.createElement('div');
        div.className = 'option';
        div.role = 'option';
        div.setAttribute('data-index', idx);
        div.textContent = `${name} — 0x${hex}`;
        if (idx === activeIndex) div.setAttribute('aria-selected','true');
        div.addEventListener('mousedown', (e)=>{ e.preventDefault(); pick(idx); });
        frag.appendChild(div);
      });
      listbox.appendChild(frag);
      if (options.length){ openList(); } else { closeList(); }
    }

    function filterOptions(){
      const q = normalizeName(itemInput.value.trim());
      options = q ? ITEMS.filter(([n]) => normalizeName(n).includes(q)) : ITEMS.slice(); // all items
      activeIndex = options.length ? 0 : -1;
      renderList();
    }

    function pick(idx){
      if (idx < 0 || idx >= options.length) return;
      const [name, hex] = options[idx];
      itemInput.value = name;
      hexPreview.textContent = `0x${hex}`;
      closeList();
    }

    // Close only on explicit outside click
    document.addEventListener('mousedown', (e)=>{
      if (!combo.contains(e.target)) closeList();
    });

    itemInput.addEventListener('focus', filterOptions);
    itemInput.addEventListener('input', ()=>{
      err.textContent = '';
      const hex = resolveHex(itemInput.value);
      hexPreview.textContent = hex ? `0x${hex}` : '—';
      filterOptions();
    });

    itemInput.addEventListener('keydown', (e)=>{
      const open = listbox.style.display !== 'none';
      if (e.key === 'ArrowDown'){
        if (!open){ filterOptions(); return; }
        e.preventDefault();
        activeIndex = Math.min(activeIndex+1, options.length-1);
        renderList(); ensureVisible();
      } else if (e.key === 'ArrowUp'){
        if (!open){ filterOptions(); return; }
        e.preventDefault();
        activeIndex = Math.max(activeIndex-1, 0);
        renderList(); ensureVisible();
      } else if (e.key === 'Enter'){
        if (open && activeIndex >= 0){ e.preventDefault(); pick(activeIndex); }
      } else if (e.key === 'Escape'){
        closeList();
      }
    });

    function ensureVisible(){
      const sel = listbox.querySelector('[aria-selected="true"]');
      if (!sel) return;
      const top = sel.offsetTop;
      const bottom = top + sel.offsetHeight;
      if (top < listbox.scrollTop) listbox.scrollTop = top;
      if (bottom > listbox.scrollTop + listbox.clientHeight)
        listbox.scrollTop = bottom - listbox.clientHeight;
    }

    // --- Collapsible source code (dynamic old_emu flag) -----------------------
    const SRC_TEMPLATE =
`@@ title = "Title"
@@ author = "Author"
@@ exit = null
@@ filler1 = 0xbbbbbbff
@@ filler2 = 0xbbbbffff
@@ filler3 = 0xbbffffff
@@ filler4 = 0xffffffff
@@ fill = false

old_emu = {OLD}

@@

sbc r11, r15, #0xae00
adc r11, r11, #{(old_emu?0xd3:0xd1)-0xb}
mov r12, #0xc0
adcs r12, r12, #0xc40
adcs r12, r12, #0xc300
adcs r12, r12, #0xc3000
strh r12, [r11, #0xb]

bic r12, r14, #0xff00
strh r13, [r4, #0x3e]
adcs r15, r12, #0x2b0`;

    function renderSource(){
      const mode = document.querySelector('input[name="emu"]:checked').value;
      const oldFlag = mode === 'old' ? '1' : '0';
      srcPre.textContent = SRC_TEMPLATE.replace('{OLD}', oldFlag);
    }

    // Initial render + update on mode change and when opening details
    renderSource();
    document.querySelectorAll('input[name="emu"]').forEach(r =>
      r.addEventListener('change', renderSource)
    );
    document.getElementById('srcWrap').addEventListener('toggle', renderSource);

    // Generate
    genBtn.addEventListener('click', ()=>{
      err.textContent = '';
      out.textContent = '';

      const hex = resolveHex(itemInput.value);
      if (!hex){
        err.textContent = 'Pick an item or type a 4-digit hex code (e.g. 0001).';
        return;
      }

      const mode = document.querySelector('input[name="emu"]:checked').value;
      const boxes = computeBoxes(hex, mode);
      out.textContent = formatOutput(boxes);
    });
  </script>
</body>
</html>
